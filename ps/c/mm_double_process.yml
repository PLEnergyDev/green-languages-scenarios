name: matrix-multiplication-double
language: c
code: |
    #include <stdio.h>
    #include <stdlib.h>

    int main(int argc, char **argv) {
        int n = atoi(argv[1]);
        int repetitions = (argc > 2) ? atoi(argv[2]) : 1000;

        double *A = malloc(n * n * sizeof(double));
        double *B = malloc(n * n * sizeof(double));
        double *C = malloc(n * n * sizeof(double));

        for (int i = 0; i < n; i++) {
            for (int j = 0; j < n; j++) {
                A[i*n + j] = B[i*n + j] = i + j;
            }
        }

        double result = 0.0;
        for (int _ = 0; _ < repetitions; _++) {
            for (int i = 0; i < n; i++) {
                for (int j = 0; j < n; j++) {
                    double sum = 0.0;
                    for (int k = 0; k < n; k++) {
                        sum += A[i*n + k] * B[k*n + j];
                    }
                    C[i*n + j] = sum;
                }
            }
            result += C[n*n - 1];
        }
        free(A);
        free(B);
        free(C);

        printf("%.0f\n", result / repetitions);
        return 0;
    }
arguments: [200, 1000]
compile_options: [-pipe, -O3, -march=native, -fomit-frame-pointer]
# expected_stdout: !!binary MTg0ODcxMDAK
# niceness: -20
affinity: [6]
# affinity: [4]
---
name: optimized
