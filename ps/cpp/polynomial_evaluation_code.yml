name: polynomial-evaluation
language: cpp
code: |
    #include <iostream>
    #include <vector>
    #include <iomanip>
    #include <measurements.h>

    void run_benchmark(int argc, char **argv) {
        int degree = std::stoi(argv[1]);
        double x = std::stod(argv[2]);
        int repetitions = (argc > 3) ? std::stoi(argv[3]) : 1000;

        std::vector<double> coeffs(degree + 1);
        for (int i = 0; i <= degree; i++) {
            coeffs[degree - i] = 1.0 / (i + 1);
        }

        double result = 0.0;
        for (int rep = 0; rep < repetitions; rep++) {
            double result = 0.0;
            for (int i = 0; i <= degree; i++) {
                result = coeffs[i] + x * result;
            }
            result += result;
        }

        std::cout << std::fixed << std::setprecision(6) << result / repetitions << std::endl;
    }

    int main(int argc, char **argv) {
        while (1) {
            if (!start_measurement()) break;
            run_benchmark(argc, argv);
            end_measurement();
        }
        return 0;
    }
arguments: [1000, 0.5, 1000000]
compile_options: [-pipe, -O3, -march=native, -fomit-frame-pointer]
expected_stdout: !!binary |
    MS4zODYyOTQK
niceness: -20
affinity: [6]
---
name: optimized
measurement_mode: internal
---
name: optimized
measurement_mode: external
