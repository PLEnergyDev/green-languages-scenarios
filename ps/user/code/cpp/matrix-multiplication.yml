name: matrix-multiplication
language: cpp
code: |
    #include <iostream>
    #include <vector>
    #include <measurements.h>

    void run_benchmark(int argc, char **argv) {
        int n = std::stoi(argv[1]);
        int repetitions = (argc > 2) ? std::stoi(argv[2]) : 1000;

        std::vector<double> A(n * n);
        std::vector<double> B(n * n);
        std::vector<double> C(n * n);

        for (int i = 0; i < n; i++) {
            for (int j = 0; j < n; j++) {
                A[i*n + j] = B[i*n + j] = i + j;
            }
        }

        double result = 0.0;
        for (int rep = 0; rep < repetitions; rep++) {
            for (int i = 0; i < n; i++) {
                for (int j = 0; j < n; j++) {
                    double sum = 0.0;
                    for (int k = 0; k < n; k++) {
                        sum += A[i*n + k] * B[k*n + j];
                    }
                    C[i*n + j] = sum;
                }
            }
            result += C[n*n - 1];
        }

        std::cout << static_cast<int>(result / repetitions) << std::endl;
    }

    int main(int argc, char **argv) {
        while (1) {
            if (!start_measurement()) break;
            run_benchmark(argc, argv);
            end_measurement();
        }
        return 0;
    }
arguments: [200, 1000]
compile_options: [-pipe, -O3, -march=native, -fomit-frame-pointer]
expected_stdout: !!binary MTg0ODcxMDAK
---
name: optimized
measurement_mode: internal
---
name: optimized
measurement_mode: external
